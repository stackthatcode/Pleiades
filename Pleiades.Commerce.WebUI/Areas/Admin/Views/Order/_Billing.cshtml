<!-- Shipping Functions -->
@Html.Javascript("/jquery/jquery.validate.min.js")
<script type="text/javascript">
    var PushMkt = PushMkt || {};

    PushMkt.AddBillingFunctions = function (model) {
        var self = model;

        self.BackToShippingInfo = function () {
            $("[name='glideToShipping']").hide();
            self.GlideLeft("Shipping", self.InitializeShippingForms);
        }

        self.InitializeBillingForms = function () {            
            $("#billingAddressForm").validate({
                rules: {
                    firstName: {
                        required: true,
                    },
                    lastName: { 
                        required: true,
                    },
                    address1: { 
                        required: true,
                    },
                    city: { 
                        required: true,
                    },
                    zipCode: { 
                        required: true,
                    },
                    state: {
                        required: true,
                    },                    
                    phone: { 
                        required: true,
                    },
                },
                highlight: function(element) {
                    $(element)
                        .closest('.control-group')
                        .addClass('error');
                },
                unhighlight:  function(element) {
                    $(element)
                        .closest('.control-group')
                        .removeClass('error');
                },
                errorPlacement: function(error,element) {
                    return true;
                },
                errorContainer: $("#addressValidationErrors"),
            });

            $("#paymentForm").validate({
                rules: {
                    cardNumber: {
                        required: true,
                        creditcard: true,
                    },
                    CVV: { 
                        required: true,
                        number: true,
                        minlength: 3,
                    },
                    expirationMonth: { 
                        required: true,
                    },
                    expirationYear: { 
                        required: true,
                    },                    
                },
                highlight: function(element) {
                    $(element)
                        .closest('.control-group')
                        .addClass('error');
                },
                unhighlight:  function(element) {
                    $(element)
                        .closest('.control-group')
                        .removeClass('error');
                },
                errorPlacement: function(error,element) {
                    return true;
                },
                errorContainer: $("#paymentValidationErrors"),
            });
        }

        self.SubmitOrder = function () {
            var failed = false;
            failed = (! $("#billingAddressForm").valid()) || failed;
            failed = (! $("#paymentForm").valid()) || failed;
            
            if (!failed) {
                alert("success!");
            }
            // DO IT!
        }
    }
</script>

<style>  
    .checkout-form2 .control-group 
    {
        margin-bottom:10px;
    }
    .checkout-form2 .control-group .control-label
    {
        width:100px;
    }    
    .checkout-form2 .control-group .controls
    {
        width:600px;
        margin-left:110px;
    }    
</style>

<!-- KNOCKOUT TEMPLATES - Billing -->
<script type="text/html" id="Top-Workspace-Billing">
	<div id="heading" class="container">
        <div class="row">
			<div class="span9">
				<h1>Create Order &gt; Billing</h1>
			</div>
			<div class="span3" style="margin-top:15px; text-align:right;">
                <a id="btn-goto-billing" class="btn btn-primary" style="width:190px;" data-bind="click: $root.SubmitOrder">
                    <i class="icon-thumbs-up icon-white"></i> OK, Submit Order <i class="icon-arrow-right icon-white"></i>
                </a>
			</div>
		</div>

        <div class="row">
            <div class="span7" style="height:48px;">
                <ul class="nav nav-pills">
                    <li style="width:270px; text-align:center;">
				        <a name="glideToShipping" href="#" class="backbutton" data-bind="click: $root.BackToShippingInfo">&laquo; Make Changes to Shipping or Order</a>
                    </li>
                </ul
            </div>
        </div>
	</div>
</script>
<script type="text/html" id="Main-Editor-Billing">
    <div style="margin-bottom:200px;">                
        <div style="float:left; width:690px;" data-bind="with: $root.Cart().BillingInfo">
            
            <h4 style="float:left; margin-bottom:15px; margin-top:20px;">Billing Address</h4>
            <a href="#" data-bind="click:$root.Cart().CopyShippingToBilling" style="margin-top:20px; margin-left:10px; float:left;">(click here to copy Shipping Address)</a>
            <div style="clear:both;"></div>

            <div id="addressValidationErrors" style="width:570px; text-align:center;" class="alert alert-error hide">
                <strong>Please enter valid Billing Address information</strong>  
		    </div>

            <form id="billingAddressForm" class="form-horizontal checkout-form1">
                <div style="height:150px;">
                    <div style="float:left; width:300px;">
                        <div class="control-group">
                            <label class="control-label" for="firstName">First Name</label>
                            <div class="controls">
                                <input type="text" name="firstName" data-bind="value: $data.FirstName" placeholder="First Name" maxlength="50">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="lastName">Last Name</label>
                            <div class="controls">
                                <input type="text" name="lastName" data-bind="value: $data.LastName" placeholder="Last Name" maxlength="50">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="address1">Address 1</label>
                            <div class="controls">
                                <input type="text" name="address1" data-bind="value: $data.Address1" placeholder="Address Line 1" maxlength="50">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="address2">Address 2</label>
                            <div class="controls">
                                <input type="text" name="address2" data-bind="value: $data.Address2" placeholder="Address Line 2" maxlength="50">
                            </div>
                        </div>
                    </div>

                    <div style="float:left; width:300px; margin-left:20px;">
                        <div class="control-group">
                            <label class="control-label" for="city">City</label>
                            <div class="controls">
                                <input type="text" name="city" data-bind="value: $data.City" placeholder="City" maxlength="25">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="state">State</label>
                            <div class="controls">
                                <select id="state" name="state"
                                    data-bind="options: PushMkt.StatesOfAmerica, optionsText: 'name', optionsValue: 'abbreviation', value: $data.State, optionsCaption:'Choose a State' " />
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="state">Zip Code</label>
                            <div class="controls">
                                <input type="text" name="zipCode" data-bind="value: $data.ZipCode" placeholder="Zip Code" maxlength="5">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            
            <h4 style="margin-bottom:15px; margin-top:40px;">Payment Information</h4>
            
            <div id="paymentValidationErrors" style="width:570px; text-align:center;" class="alert alert-error hide">
                <strong>Please enter valid Payment Information</strong>  
		    </div>

            <form id="paymentForm" class="form-horizontal checkout-form2">
                <div data-bind="with: $root.Cart().BillingInfo">
                    <div style="clear:both;">
                        <div class="control-group" style="float:left; width:270px;">
                            <label class="control-label" for="cardNumber">Card Number</label>
                            <div class="controls">
                                <input type="text" name="cardNumber" data-bind="value: $data.CardNumber" placeholder="Card Number" maxlength="16">
                            </div>
                        </div>
                        <div class="control-group" style="float:left; width:200px;">
                            <label class="control-label" for="CVV">CVV</label>
                            <div class="controls">
                                <input type="text" style="width:75px;" name="CVV" data-bind="value: $data.CVV" placeholder="CVV" maxlength="16">
                            </div>
                        </div>
                    </div>
                    
                    <div style="clear:both;">
                        <div class="control-group" style="float:left; width:200px;">
                            <label class="control-label" for="lastName">Expires Month</label>
                            <div class="controls">
                                <select id="state" name="expirationMonth" style="width:100px;"
                                    data-bind="options: PushMkt.ExpirationMonths, value: $data.ExpirationMonth, optionsCaption:'Month' " />
                            </div>
                        </div>
                        <div class="control-group" style="float:left; width:240px;">
                            <label class="control-label" for="lastName">Expires Year</label>
                            <div class="controls">
                                <select id="state" name="expirationYear" style="width:100px;"
                                    data-bind="options: PushMkt.ExpirationYears, value: $data.ExpirationYear, optionsCaption:'Year' " />
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div style="float:left; width:250px;" data-bind="template: { name: 'Order-Summary' }">
        </div>

        <!-- Add Shipping Info Summary -->
    </div>
</script>